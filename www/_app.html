$routes[
    $.package_all[^Route::create[/;
        $.controller[PackagesController] $.action[all]
    ]]
    $.migrate[^Route::create[/migrate;
        $.controller[MigrationController] $.action[migrate]
    ]]
    $.hook[^Route::create[/hook;
        $.controller[HookController] $.action[chooseByType]
    ]]
    $.login[^Route::create[/login;
        $.controller[UserController] $.action[login]
    ]]
    $.logout[^Route::create[/logout;
        $.controller[UserController] $.action[logout]
    ]]
    $.package[^Route::create[/package;
        $.controller[PackagesController] $.action[list]
    ]]
    $.package_add[^Route::create[/package/add;
        $.controller[PackagesController] $.action[add]
    ]]
]

$matcher[^Matcher::create[$routes]]


$variables[^matcher.match[/$form:fields.request]]

$controller[^reflection:create[$variables.controller;create]]
$methodInfo[^reflection:method_info[$variables.controller;${variables.action}Action]]

# Prepare arguments string
$arguments[^hash::create[]]
^for[i](0;$methodInfo.max_params){
    $arguments.$i[$variables.[$methodInfo.$i]]
}
$argumentsString[^arguments.foreach[key;value]{$value}[^;]]


# Executes controller action with right ordered actions
^process{^^controller.[^${variables.action}Action][$argumentsString]}
